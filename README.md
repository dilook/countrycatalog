# Country Catalog

## Обзор проекта

Country Catalog - это REST API приложение на Spring Boot для управления каталогом стран. Приложение предоставляет возможность получать информацию о странах, добавлять новые страны, обновлять и удалять существующие.

## Технический стек

- Java 21
- Spring Boot 3.5.0
- Spring Data JPA
- PostgreSQL
- Flyway для миграций базы данных
- Gradle для сборки проекта

## Как собрать и запустить приложение

### Предварительные требования

- JDK 21
- PostgreSQL 
- Gradle

### Настройка базы данных

1. Создайте базу данных PostgreSQL с именем `country_catalog`:
```sql
CREATE DATABASE country_catalog;
```

2. Настройте доступ к базе данных в файле `src/main/resources/application.yaml`:
```yaml
spring:
  datasource:
    url: 'jdbc:postgresql://localhost:5432/country_catalog'
    username: postgres
    password: secret
```

### Сборка и запуск

1. Клонируйте репозиторий:
```bash
git clone <url-репозитория>
cd countrycatalog
```

2. Соберите проект с помощью Gradle:
```bash
./gradlew build
```

3. Запустите приложение:
```bash
./gradlew bootRun
```

Приложение будет доступно по адресу: http://localhost:9090

## API Endpoints

### Получение всех стран

```
GET /api/country/all
```

Возвращает список всех стран в формате JSON.

### Получение страны по коду

```
GET /api/country?code={code}
```

Параметры:
- `code` - код страны (например, "RU" для России)

Возвращает информацию о стране с указанным кодом.

### Создание новой страны

```
POST /api/country/create
```

Тело запроса (JSON):
```json
{
  "name": "Название страны",
  "code": "КОД"
}
```

Создает новую страну и возвращает созданный объект.

### Обновление страны

```
PATCH /api/country/update/{code}
```

Параметры пути:
- `code` - код страны для обновления

Тело запроса (JSON):
```json
{
  "name": "Новое название страны",
  "code": "НОВЫЙ_КОД"
}
```

Обновляет информацию о стране с указанным кодом.

### Удаление страны

```
DELETE /api/country/delete/{code}
```

Параметры пути:
- `code` - код страны для удаления

Удаляет страну с указанным кодом.

## Структура базы данных

База данных содержит одну таблицу `country` со следующей структурой:

| Поле | Тип | Описание |
|------|-----|----------|
| id   | UUID | Уникальный идентификатор (первичный ключ) |
| name | varchar(50) | Название страны (уникальное, не null) |
| code | varchar(5) | Код страны (уникальный, не null) |

## Структура проекта

```
src/
├── main/
│   ├── java/
│   │   └── guru/
│   │       └── qa/
│   │           └── countrycatalog/
│   │               ├── controller/       # REST контроллеры
│   │               ├── data/             # Сущности и репозитории
│   │               ├── domain/           # Доменные модели
│   │               ├── exception/        # Обработка исключений
│   │               ├── service/          # Бизнес-логика
│   │               └── CountrycatalogApplication.java
│   └── resources/
│       ├── application.yaml              # Конфигурация приложения
│       └── db/
│           └── migration/
│               └── country/
│                   └── V1__schema_init.sql  # Миграция для инициализации схемы
└── test/
    └── java/
        └── guru/
            └── qa/
                └── countrycatalog/
                    └── controller/       # Тесты контроллеров
```

## Обработка ошибок

Приложение возвращает следующие HTTP-коды ошибок:

- 404 Not Found - если страна с указанным кодом не найдена
- 400 Bad Request - если запрос содержит некорректные данные
- 500 Internal Server Error - в случае внутренней ошибки сервера

## Миграции базы данных

Приложение использует Flyway для управления миграциями базы данных. При первом запуске приложения автоматически создается таблица `country` и заполняется начальными данными (175 стран).
